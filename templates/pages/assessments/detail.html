{% extends 'base.html' %}
{% load humanize static %}
{% block title %}{{ assessment.seo_title }}{% endblock %}
{% block meta_description %}{{ assessment.seo_description }}{% endblock %}
{% block extra_meta %}
    {% if assessment.meta_keywords %}<meta name="keywords" content="{{ assessment.meta_keywords }}">{% endif %}
    {% if assessment.meta_image %}<meta property="og:image" content="{{ assessment.meta_image }}">{% endif %}
    <meta property="og:type" content="product">
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Product",
        "name": "{{ assessment.title|escapejs }}",
        "description": "{{ assessment.seo_description|escapejs }}",
        {% if assessment.meta_image or assessment.featured_image %}"image": "{{ assessment.meta_image|default:assessment.featured_image }}",{% endif %}
        "brand": {
            "@type": "Organization",
            "name": "Evalon"
        },
        "offers": {
            "@type": "Offer",
            "url": "{{ request.build_absolute_uri }}",
            "priceCurrency": "USD",
            "price": "0",
            "availability": "https://schema.org/InStock"
        }
    }
    </script>
{% endblock %}
{% block content %}
<div class="page-shell">
    {% include 'includes/site_header.html' with active='assessments' %}
    <main>
        <div class="assessment-detail-shell">
            {# Hero Section #}
            <header class="assessment-detail-hero">
                <div class="hero-content">
                    <div class="breadcrumb">
                        <a href="{% url 'pages:assessment_list' %}">Assessment Library</a>
                        <span>/</span>
                        <span>{{ assessment.label }}</span>
                    </div>
                    {% if preview_mode %}
                    <div class="preview-banner">
                        <strong>Preview mode</strong>
                        <span>Only visible with a valid preview link.</span>
                    </div>
                    {% endif %}
                    <span class="pill">{{ assessment.label }}</span>
                    <h1>{{ assessment.title }}</h1>
                    {% if assessment.subtitle %}
                    <p class="subtitle">{{ assessment.subtitle }}</p>
                    {% endif %}
                    <p class="summary">{{ assessment.summary }}</p>
                    <div class="hero-stats">
                        <div class="stat">
                            <span class="stat-value">{{ assessment.duration_minutes }} min</span>
                            <span class="stat-label">Duration</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">{{ assessment.question_count }}</span>
                            <span class="stat-label">Questions</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">{{ assessment.get_difficulty_level_display }}</span>
                            <span class="stat-label">Difficulty</span>
                        </div>
                    </div>
                    <div class="hero-cta">
                        <a href="{% if assessment.cta_url %}{{ assessment.cta_url }}{% else %}{% url 'clients:signup' %}{% endif %}" class="btn btn-pill">{{ assessment.cta_label }}</a>
                        <a href="{% url 'pages:contact' %}" class="btn btn-outline">Contact sales</a>
                    </div>
                </div>
                {% if assessment.featured_image %}
                <figure class="hero-image">
                    <img src="{{ assessment.featured_image }}" alt="{{ assessment.title }}">
                </figure>
                {% endif %}
            </header>

            {# Overview Section #}
            {% if assessment.description or assessment.overview_content %}
            <section class="assessment-section" id="overview">
                <div class="section-content">
                    <h2>Overview</h2>
                    {% if assessment.overview_content %}
                    <div class="rich-content">{{ assessment.overview_content|safe }}</div>
                    {% else %}
                    <p>{{ assessment.description }}</p>
                    {% endif %}
                </div>
            </section>
            {% endif %}

            {# Focus Areas #}
            {% if assessment.focus_areas %}
            <section class="assessment-section bg-light" id="focus">
                <div class="section-content">
                    <h2>Focus Areas</h2>
                    <p class="section-lede">This assessment covers the following key areas to evaluate candidate proficiency.</p>
                    <div class="focus-tags">
                        {% for area in assessment.focus_areas %}
                        <span class="focus-tag">{{ area }}</span>
                        {% endfor %}
                    </div>
                </div>
            </section>
            {% endif %}

            {# Skills Tested #}
            {% if assessment.skills_tested %}
            <section class="assessment-section" id="skills">
                <div class="section-content">
                    <h2>Skills Tested</h2>
                    <p class="section-lede">Each candidate is evaluated across these core competencies.</p>
                    <div class="skills-grid">
                        {% for skill in assessment.skills_tested %}
                        <article class="skill-card">
                            <h3>{{ skill.name }}</h3>
                            <p>{{ skill.description }}</p>
                        </article>
                        {% endfor %}
                    </div>
                </div>
            </section>
            {% endif %}

            {# Sample Questions #}
            {% if assessment.sample_questions %}
            <section class="assessment-section bg-light" id="samples">
                <div class="section-content">
                    <h2>Sample Questions</h2>
                    <p class="section-lede">Get a preview of the types of questions candidates will encounter.</p>
                    <div class="assessment-samples-list">
                        {% for sample in assessment.sample_questions %}
                        <article class="assessment-sample-card">
                            <div class="sample-number">{{ forloop.counter }}</div>
                            <div class="sample-body">
                                <span class="sample-type-badge">{{ sample.type|default:"Scenario" }}</span>
                                <p class="sample-question-text">{{ sample.question }}</p>
                            </div>
                        </article>
                        {% endfor %}
                    </div>
                </div>
            </section>
            {% endif %}

            {# Scoring Rubric #}
            {% if assessment.scoring_rubric %}
            <section class="assessment-section" id="scoring">
                <div class="section-content">
                    <h2>Scoring Methodology</h2>
                    <div class="rich-content">{{ assessment.scoring_rubric|linebreaks }}</div>
                </div>
            </section>
            {% endif %}

            {# Stats #}
            {% if assessment.stats %}
            <section class="assessment-section bg-gradient" id="stats">
                <div class="section-content">
                    <h2 class="stats-title">Assessment at a Glance</h2>
                    <div class="stats-grid">
                        {% for stat in assessment.stats %}
                        <div class="stat-box">
                            <span class="stat-value">{{ stat.value }}</span>
                            <span class="stat-label">{{ stat.label }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </section>
            {% endif %}

            {# Use Cases #}
            {% if assessment.use_cases %}
            <section class="assessment-section" id="use-cases">
                <div class="section-content">
                    <h2>When to Use This Assessment</h2>
                    <p class="section-lede">Common hiring scenarios where this assessment provides the most value.</p>
                    <div class="use-cases-grid">
                        {% for case in assessment.use_cases %}
                        <article class="use-case-card">
                            <div class="use-case-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                </svg>
                            </div>
                            <div class="use-case-content">
                                <h3>{{ case.title }}</h3>
                                <p>{{ case.description }}</p>
                            </div>
                        </article>
                        {% endfor %}
                    </div>
                </div>
            </section>
            {% endif %}

            {# FAQs #}
            {% if assessment.faqs %}
            <section class="assessment-section bg-light" id="faqs">
                <div class="section-content">
                    <h2>Frequently Asked Questions</h2>
                    <div class="faq-list">
                        {% for faq in assessment.faqs %}
                        <details class="faq-item">
                            <summary>{{ faq.question }}</summary>
                            <div class="faq-answer">{{ faq.answer }}</div>
                        </details>
                        {% endfor %}
                    </div>
                </div>
            </section>
            {% endif %}

            {# Final CTA #}
            <section class="assessment-cta">
                <div class="cta-content">
                    <h2>Ready to assess candidates with {{ assessment.label }}?</h2>
                    <p>Start your free trial and send assessments to candidates in minutes.</p>
                    <div class="cta-buttons">
                        <a href="{% if assessment.cta_url %}{{ assessment.cta_url }}{% else %}{% url 'clients:signup' %}{% endif %}" class="btn btn-pill">{{ assessment.cta_label }}</a>
                        <a href="{% url 'pages:contact' %}" class="btn btn-outline-white">Talk to sales</a>
                    </div>
                </div>
            </section>

            {# Related Assessments #}
            {% if related_assessments %}
            <section class="assessment-section" id="related">
                <div class="section-content">
                    <h2>Explore More Assessments</h2>
                    <p class="section-lede">Discover other assessments that might fit your hiring needs.</p>
                    <div class="related-grid">
                        {% for related in related_assessments %}
                        <article class="related-card">
                            <span class="pill subtle">{{ related.label }}</span>
                            <h3><a href="{{ related.get_absolute_url }}">{{ related.title }}</a></h3>
                            <p>{{ related.summary|truncatewords:20 }}</p>
                            <div class="related-meta">
                                <span>{{ related.duration_minutes }} min</span>
                                <span>{{ related.question_count }} questions</span>
                            </div>
                        </article>
                        {% endfor %}
                    </div>
                </div>
            </section>
            {% endif %}
        </div>
    </main>
</div>
{% endblock %}
