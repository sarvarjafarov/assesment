{% extends 'base.html' %}
{% load humanize static %}
{% block title %}{{ role.role_seo_title }}{% endblock %}
{% block meta_description %}{{ role.role_seo_description }}{% endblock %}
{% block extra_meta %}
    {% if role.meta_keywords %}<meta name="keywords" content="{{ role.meta_keywords }}">{% endif %}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Product",
        "name": "{{ role.title }} Assessment Battery",
        "description": "{{ role.role_seo_description|escapejs }}",
        "brand": {
            "@type": "Organization",
            "name": "Evalon"
        },
        "offers": {
            "@type": "Offer",
            "url": "{{ request.build_absolute_uri }}",
            "priceCurrency": "USD",
            "price": "0",
            "availability": "https://schema.org/InStock"
        }
    }
    </script>
{% endblock %}
{% block content %}
<div class="page-shell">
    {% include 'includes/site_header.html' with active='assessments' %}
    <main>
        <div class="rp-detail-shell">
            {# Hero #}
            <header class="rp-detail-hero">
                <div class="rp-detail-hero-inner">
                    <div class="rp-breadcrumb">
                        <a href="{% url 'pages:assessment_list' %}">Assessments</a>
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg>
                        <a href="{% url 'pages:role_assessment_list' %}">Roles</a>
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"></polyline></svg>
                        <span>{{ role.title }}</span>
                    </div>
                    <div class="rp-detail-badges">
                        <span class="rp-badge rp-badge--dept">{{ role.department }}</span>
                        <span class="rp-badge rp-badge--level">{{ role.get_seniority_level_display }}</span>
                    </div>
                    <h1 class="rp-detail-title">Best Assessments for Hiring a {{ role.title }}</h1>
                    <p class="rp-detail-desc">{{ role.description }}</p>
                    <div class="rp-detail-stats">
                        <div class="rp-detail-stat">
                            <span class="rp-detail-stat-val">{{ total_duration }} min</span>
                            <span class="rp-detail-stat-lbl">Total Duration</span>
                        </div>
                        <div class="rp-detail-stat">
                            <span class="rp-detail-stat-val">{{ total_questions }}</span>
                            <span class="rp-detail-stat-lbl">Questions</span>
                        </div>
                        <div class="rp-detail-stat">
                            <span class="rp-detail-stat-val">{{ recommended_assessments|length }}</span>
                            <span class="rp-detail-stat-lbl">Assessments</span>
                        </div>
                    </div>
                </div>
            </header>

            {# Key Skills #}
            {% if role.key_skills %}
            <section class="rp-section" id="skills">
                <div class="rp-section-inner">
                    <h2 class="rp-section-title">Key Skills to Assess</h2>
                    <p class="rp-section-desc">Core competencies required for {{ role.title }} candidates.</p>
                    <div class="rp-skills-tags">
                        {% for skill in role.key_skills %}
                        <span class="rp-skill-tag">{{ skill }}</span>
                        {% endfor %}
                    </div>
                </div>
            </section>
            {% endif %}

            {# Responsibilities #}
            {% if role.responsibilities %}
            <section class="rp-section rp-section--alt" id="responsibilities">
                <div class="rp-section-inner">
                    <h2 class="rp-section-title">Role Responsibilities</h2>
                    <p class="rp-section-desc">What {{ role.title|lower }}s are expected to do.</p>
                    <ul class="rp-responsibilities">
                        {% for resp in role.responsibilities %}
                        <li>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"></polyline></svg>
                            <span>{{ resp }}</span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </section>
            {% endif %}

            {# Focus Areas #}
            {% if focus_areas %}
            <section class="rp-section" id="focus">
                <div class="rp-section-inner">
                    <h2 class="rp-section-title">Focus Areas</h2>
                    <p class="rp-section-desc">Key areas evaluated across the assessment battery for {{ role.title }} candidates.</p>
                    <div class="rp-tags">
                        {% for area in focus_areas %}
                        <span class="rp-tag">{{ area }}</span>
                        {% endfor %}
                    </div>
                </div>
            </section>
            {% endif %}

            {# Skills Tested #}
            {% if skills_tested %}
            <section class="rp-section rp-section--alt" id="skills-tested">
                <div class="rp-section-inner">
                    <h2 class="rp-section-title">Skills Tested</h2>
                    <p class="rp-section-desc">Competencies measured across all recommended assessments.</p>
                    <div class="rp-skills-grid">
                        {% for skill in skills_tested %}
                        <div class="rp-skill-card">
                            <h3>{{ skill.name }}</h3>
                            <p>{{ skill.description }}</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </section>
            {% endif %}

            {# Recommended Assessment Battery #}
            {% if recommended_assessments %}
            <section class="rp-section" id="assessments">
                <div class="rp-section-inner">
                    <h2 class="rp-section-title">Recommended Assessment Battery</h2>
                    <p class="rp-section-desc">Use these assessments together for a comprehensive evaluation of {{ role.title }} candidates.</p>
                    <div class="rp-battery">
                        {% for assessment in recommended_assessments %}
                        <a class="rp-battery-card" href="{{ assessment.get_absolute_url }}"
                           data-gtag-click="role_assessment_battery_click"
                           data-gtag-category="engagement"
                           data-gtag-label="{{ assessment.slug }}">
                            <div class="rp-battery-icon">
                                {% if assessment.icon_svg %}{{ assessment.icon_svg|safe }}{% endif %}
                            </div>
                            <div class="rp-battery-body">
                                <span class="rp-battery-label">{{ assessment.label }}</span>
                                <h3>{{ assessment.title }}</h3>
                                <p>{{ assessment.summary|truncatewords:20 }}</p>
                                <div class="rp-battery-meta">
                                    <span>{{ assessment.duration_minutes }} min</span>
                                    <span>{{ assessment.question_count }} questions</span>
                                    <span>{{ assessment.get_difficulty_level_display }}</span>
                                </div>
                            </div>
                            <svg class="rp-battery-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
                        </a>
                        {% endfor %}
                    </div>
                </div>
            </section>
            {% endif %}

            {# Sample Questions #}
            {% if sample_questions %}
            <section class="rp-section rp-section--alt" id="samples">
                <div class="rp-section-inner">
                    <h2 class="rp-section-title">Sample Questions</h2>
                    <p class="rp-section-desc">Preview the types of questions {{ role.title }} candidates encounter.</p>
                    <div class="rp-samples">
                        {% for sample in sample_questions %}
                        <div class="rp-sample">
                            <span class="rp-sample-num">{{ forloop.counter }}</span>
                            <div class="rp-sample-body">
                                <span class="rp-sample-type">{{ sample.type|default:"Scenario" }}</span>
                                <p>{{ sample.question }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </section>
            {% endif %}

            {# Use Cases #}
            {% if use_cases %}
            <section class="rp-section" id="use-cases">
                <div class="rp-section-inner">
                    <h2 class="rp-section-title">When to Use These Assessments</h2>
                    <p class="rp-section-desc">Ideal scenarios for deploying this assessment battery.</p>
                    <div class="rp-usecases">
                        {% for case in use_cases %}
                        <div class="rp-usecase">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                            <div>
                                <h3>{{ case.title }}</h3>
                                <p>{{ case.description }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </section>
            {% endif %}

            {# FAQs #}
            {% if faqs %}
            <section class="rp-section rp-section--alt" id="faqs">
                <div class="rp-section-inner">
                    <h2 class="rp-section-title">Frequently Asked Questions</h2>
                    <div class="rp-faqs">
                        {% for faq in faqs %}
                        <details class="rp-faq">
                            <summary>{{ faq.question }}</summary>
                            <div class="rp-faq-answer">{{ faq.answer }}</div>
                        </details>
                        {% endfor %}
                    </div>
                </div>
            </section>
            {% endif %}

            {# CTA #}
            <section class="rp-cta">
                <div class="rp-cta-inner">
                    <h2>Start assessing {{ role.title }} candidates today</h2>
                    <p>Send assessments in minutes with automated scoring and detailed reports.</p>
                    <div class="rp-cta-actions">
                        <a class="rp-btn-primary" href="{% url 'clients:signup' %}"
                           data-gtag-click="role_detail_cta_click"
                           data-gtag-category="engagement"
                           data-gtag-label="{{ role.slug }}">Start Free Trial</a>
                        <a class="rp-btn-secondary" href="{% url 'pages:contact' %}"
                           data-gtag-click="contact_sales_click"
                           data-gtag-category="engagement"
                           data-gtag-label="role_contact_sales">Talk to sales</a>
                    </div>
                </div>
            </section>

            {# Interview Questions Cross-link #}
            {% if has_interview_questions %}
            <section class="rp-section" id="interview-questions">
                <div class="rp-section-inner">
                    <a class="rp-crosslink" href="{{ role.get_interview_questions_url }}"
                       data-gtag-click="role_to_questions_click"
                       data-gtag-category="engagement"
                       data-gtag-label="{{ role.slug }}">
                        <div class="rp-crosslink-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                        </div>
                        <div class="rp-crosslink-body">
                            <h3>{{ role.title }} Interview Questions</h3>
                            <p>Browse curated interview questions with difficulty ratings, evaluation criteria, and sample answer guidance.</p>
                        </div>
                        <svg class="rp-crosslink-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
                    </a>
                </div>
            </section>
            {% endif %}

            {# Related Roles #}
            {% if related_roles %}
            <section class="rp-section" id="related">
                <div class="rp-section-inner">
                    <h2 class="rp-section-title">Related Roles</h2>
                    <div class="rp-related">
                        {% for rel in related_roles %}
                        <a class="rp-related-card" href="{{ rel.get_absolute_url }}"
                           data-gtag-click="related_role_click"
                           data-gtag-category="engagement"
                           data-gtag-label="{{ rel.slug }}">
                            <span class="rp-related-dept">{{ rel.department }}</span>
                            <h3>{{ rel.title }}</h3>
                            <p>{{ rel.description|truncatewords:15 }}</p>
                        </a>
                        {% endfor %}
                    </div>
                </div>
            </section>
            {% endif %}
        </div>
    </main>
</div>
{% endblock %}
