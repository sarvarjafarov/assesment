{% extends 'base.html' %}
{% load static %}
{% block title %}Sira · Assessments API{% endblock %}
{% block content %}
<div class="page-shell">
    <header class="site-header">
        <nav class="nav">
            <div class="brand">
                <a href="{% url 'pages:home' %}">
                    <img src="{% static 'img/logo-glyph.svg' %}" alt="Sira logo" />
                </a>
                <span>Sira</span>
            </div>
            <ul class="nav-links">
                <li><a href="{% url 'pages:home' %}#products">Products</a></li>
                <li><a href="{% url 'pages:home' %}#industries">Industries</a></li>
                <li><a href="{% url 'pages:home' %}#blog">Blog</a></li>
                <li><a class="is-active" href="{% url 'marketing_assessments:api' %}">API</a></li>
            </ul>
            <div class="nav-actions">
                <a class="btn btn-outline small" href="{% url 'console:login' %}">Customer Login</a>
                <a class="btn btn-pill" href="{% url 'pages:home' %}#cta">Book a Demo</a>
            </div>
        </nav>
    </header>

    <main class="api-shell">
        <section class="panel hero">
            <p class="eyebrow">API integration</p>
            <h1>Connect every Sira assessment to your stack.</h1>
            <p class="lede">Behavioral, digital marketing, and future role modules run through one secure REST API.</p>
        </section>

        <section class="panel endpoint-panel">
            <header class="panel-heading">
                <div>
                    <p class="eyebrow">Endpoints</p>
                    <h2>REST endpoints</h2>
                </div>
                <p class="lede">Call these endpoints with your <code>X-API-Key</code> header.</p>
            </header>
            <div class="api-endpoints">
                {% for endpoint in rest_endpoints %}
                <article class="endpoint-card">
                    <div class="method">{{ endpoint.method }}</div>
                    <div class="path">{{ endpoint.path }}</div>
                    <p>{{ endpoint.description }}</p>
                </article>
                {% endfor %}
            </div>
        </section>

        <section class="panel token-panel">
            <div class="section-heading align-left">
                <h2>Authentication & tokens</h2>
                <p class="lede">Use the API key we issue per workspace. Rotate tokens anytime.</p>
            </div>
            <div class="token-card">
                <div>
                    <p class="label">Example header</p>
                    <pre><code id="tokenSample">X-API-Key: sk_live_a1b2c3d4e5f6</code></pre>
                </div>
                <div class="token-actions">
                    <button class="btn btn-pill secondary token-generate" type="button" data-token-target="#tokenSample">Generate mock token</button>
                    <button class="btn btn-pill copy-trigger" type="button" data-copy-target="#tokenSample" data-copy-label="Copy header" data-copy-success="Copied!">Copy header</button>
                </div>
            </div>
        </section>

{% with samples=language_examples %}
        <section class="panel language-info-panel">
            <div class="language-flex">
                <div class="language-copy">
                    <p class="eyebrow">Language examples</p>
                    <h2>Built for any stack and ready in minutes.</h2>
                    <p class="lede">Use the snippets below to launch assessments directly from your product, workflow tools, or ATS.</p>
                    <div class="language-pill-row">
                        {% for sample in language_examples %}
                        <span class="language-pill">{{ sample.title }}</span>
                        {% endfor %}
                    </div>
                    <ul class="language-highlights">
                        <li>Single API key powers behavioral & digital marketing modules.</li>
                        <li>Safe retries + idempotency tokens keep submissions intact.</li>
                        <li>Webhook callbacks notify you when candidates finish.</li>
                    </ul>
                </div>
                <div class="language-aside">
                    <div class="language-aside-card">
                        <p class="label">Reliability snapshot</p>
                        <div class="language-stats">
                            <article>
                                <strong>{{ language_examples|length }}</strong>
                                <span>Ready-made snippets</span>
                            </article>
                            <article>
                                <strong>120&nbsp;ms</strong>
                                <span>Avg API latency</span>
                            </article>
                            <article>
                                <strong>99.9%</strong>
                                <span>Uptime SLA</span>
                            </article>
                        </div>
                        <ul class="language-aside-list">
                            <li>Webhook retry strategy with exponential backoff.</li>
                            <li>Idempotency safeguards prevent duplicate sessions.</li>
                            <li>Role-scoped keys so each workspace stays isolated.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
        <section class="panel language-code-panel" data-language-switcher>
            <header class="panel-heading">
                <div>
                    <p class="eyebrow">Client libraries</p>
                    <h2>Plug Sira into any stack.</h2>
                </div>
                <p class="lede">Pick your language to see a ready-to-copy snippet.</p>
            </header>
            <div class="language-tabs" role="tablist">
                {% for sample in samples %}
                <button class="language-tab {% if forloop.first %}is-active{% endif %}" type="button" data-language-tab="{{ forloop.counter0 }}">
                    <span class="language-token">{{ sample.title|slice:":1"|upper }}</span>
                    <span>{{ sample.title }}</span>
                </button>
                {% endfor %}
            </div>
            <div class="language-card-stack">
                {% for sample in samples %}
                <article class="snippet-card language-card {% if forloop.first %}is-active{% endif %}" data-language-panel="{{ forloop.counter0 }}">
                    <div class="snippet-header">
                        <div>
                            <p class="label">Client library</p>
                            <strong>{{ sample.title }}</strong>
                        </div>
                        <button class="btn btn-pill copy-trigger dark" type="button" data-copy-target="#languageSnippet{{ forloop.counter }}" data-copy-label="Copy" data-copy-success="Copied!">Copy</button>
                    </div>
                    <pre><code id="languageSnippet{{ forloop.counter }}">{{ sample.code }}</code></pre>
                </article>
                {% endfor %}
            </div>
        </section>
{% endwith %}

        <section class="panel integration-panel stacks-panel">
            <div class="stacks-intro">
                <p class="eyebrow">Integrations</p>
                <h2>Stacks & sample payloads</h2>
                <p class="lede">Use our REST interface across any stack, or drop these request/response samples to speed up QA.</p>
            </div>
            <div class="stacks-grid">
                <div class="stack-card">
                <h2>Stacks we support</h2>
                <p class="lede">Embed Sira into any workflow or automation platform.</p>
                <ul>
                    <li><span>Python</span> (requests, Django, FastAPI)</li>
                    <li><span>Node.js</span> (fetch, Axios, Nest)</li>
                    <li><span>Ruby, Go, Java</span> and more</li>
                    <li><span>Automation</span> Zapier, Make, Workato</li>
                    <li><span>ATS partners</span> Lever, Greenhouse, Ashby</li>
                </ul>
            </div>
            <div class="stacks-note">
                <p class="label">How teams use this</p>
                <ul>
                    <li>ATS sync: auto-create candidate entries when a new session starts.</li>
                    <li>Workflow automations: route high-scorers into Calendly/HubSpot.</li>
                    <li>Custom dashboards: pull JSON payloads into BI tools for reporting.</li>
                </ul>
            </div>
            </div>
            </div>
        </section>

        <section class="panel sample-panel">
            <div class="sample-intro">
                <div class="sample-copy">
                    <p class="eyebrow">Sample requests & responses</p>
                    <h2>Drop-in payloads for your QA team.</h2>
                    <p class="lede">Start, submit, and fetch results with predictable JSON bodies and idempotent endpoints.</p>
                </div>
                <div class="sample-note">
                    <p>Pair these with our webhooks to keep ATS, CRM, and analytics tools in sync.</p>
                </div>
            </div>
            <div class="sample-flow">
                <article class="sample-card is-start">
                    <span class="step-badge">01</span>
                    <div class="sample-card-header">
                        <div>
                            <p class="label">Start a session</p>
                            <strong>POST /api/marketing-assessment/start/</strong>
                        </div>
                        <button class="btn btn-pill copy-trigger dark" type="button" data-copy-target="#sampleCode1" data-copy-label="Copy" data-copy-success="Copied!">Copy</button>
                    </div>
<pre><code id="sampleCode1">{
  "candidate_id": "cand-123"
} 
→ { "session_uuid": "uuid" }</code></pre>
                </article>
                <article class="sample-card is-process">
                    <span class="step-badge">02</span>
                    <div class="sample-card-header">
                        <div>
                            <p class="label">Fetch results</p>
                            <strong>GET /api/marketing-assessment/cand-123/results/</strong>
                        </div>
                        <button class="btn btn-pill copy-trigger dark" type="button" data-copy-target="#sampleCode2" data-copy-label="Copy" data-copy-success="Copied!">Copy</button>
                    </div>
<pre><code id="sampleCode2">{
  "overall_score": 82.5,
  "category_breakdown": {...},
  "recommendations": {...}
}</code></pre>
                </article>
                <article class="sample-card is-complete">
                    <span class="step-badge">03</span>
                    <div class="sample-card-header">
                        <div>
                            <p class="label">Submit responses</p>
                            <strong>POST /api/marketing-assessment/cand-123/submit/</strong>
                        </div>
                        <button class="btn btn-pill copy-trigger dark" type="button" data-copy-target="#sampleCode3" data-copy-label="Copy" data-copy-success="Copied!">Copy</button>
                    </div>
<pre><code id="sampleCode3">[
  {"question_id": 45, "answer": "B"},
  {"question_id": 52, "selected": "most"}
]
→ { "detail": "Assessment submitted", "session_uuid": "uuid" }</code></pre>
                </article>
            </div>
        </section>

        <section class="panel request-panel">
            <div class="request-intro">
                <div class="request-copy">
                    <p class="eyebrow">Access request</p>
                    <h2>Request access</h2>
                    <p class="lede">Need credentials? Tell us how you plan to use the API and we’ll send a token within one business day.</p>
                </div>
                <div class="request-note">
                    <p class="label">What to include</p>
                    <ul>
                        <li>Describe your integration target (ATS, CRM, internal tooling).</li>
                        <li>Share required assessment types or expected volume.</li>
                        <li>List teammates who need read/write keys.</li>
                    </ul>
                </div>
            </div>
            <form method="post" class="form-stack request-form">
                {% csrf_token %}
                <div class="form-row">
                    <div class="form-field">
                        {{ form.company_name.label_tag }}
                        {{ form.company_name }}
                        {% for error in form.company_name.errors %}
                        <span class="field-error">{{ error }}</span>
                        {% endfor %}
                    </div>
                    <div class="form-field">
                        {{ form.contact_email.label_tag }}
                        {{ form.contact_email }}
                        {% for error in form.contact_email.errors %}
                        <span class="field-error">{{ error }}</span>
                        {% endfor %}
                    </div>
                </div>
                <div class="form-field">
                    {{ form.use_case.label_tag }}
                    {{ form.use_case }}
                    {% for error in form.use_case.errors %}
                    <span class="field-error">{{ error }}</span>
                    {% endfor %}
                </div>
                <button class="btn btn-pill" type="submit">Submit request</button>
            </form>
        </section>
    </main>

    <footer class="site-footer">
        <div>© {% now "Y" %} Sira</div>
        <div class="footer-links">
            <a href="#">Privacy Policy</a>
            <a href="#">Terms of Service</a>
            <a href="#">Resources</a>
        </div>
        <div>Made with <span>♥</span> by Sira</div>
    </footer>
</div>
{% endblock %}
