{% extends 'portal_base.html' %}
{% load static %}
{% block title %}Settings Â· Evalon{% endblock %}
{% block meta_description %}Manage your account settings and preferences.{% endblock %}
{% block portal_content %}
<div class="portal-shell">
    <header class="page-header-with-actions">
        <div>
            <h1>Settings</h1>
            <p class="muted">Manage your account and preferences</p>
        </div>
    </header>

    {# Account Information #}
    <section class="settings-section">
        <div class="settings-section-header">
            <h2>Account Information</h2>
            <p class="muted">Your workspace details and contact information</p>
        </div>
        <div class="portal-card">
            <div class="settings-row">
                <div class="setting-info">
                    <h4>Company Name</h4>
                    <p class="muted">{{ account.company_name }}</p>
                </div>
            </div>
            <div class="settings-row">
                <div class="setting-info">
                    <h4>Email Address</h4>
                    <p class="muted">{{ account.email }}</p>
                </div>
            </div>
            <div class="settings-row">
                <div class="setting-info">
                    <h4>Account Role</h4>
                    <p class="muted">{{ role_label }}</p>
                </div>
            </div>
            <div class="settings-row">
                <div class="setting-info">
                    <h4>Member Since</h4>
                    <p class="muted">{{ account.created_at|date:"F j, Y" }}</p>
                </div>
            </div>
        </div>
    </section>

    {# Branding Settings - Only for managers and branding managers #}
    {% if can_manage_branding %}
    <section class="settings-section">
        <div class="settings-section-header">
            <h2>Branding</h2>
            <p class="muted">Customize assessment invitations with your company logo</p>
        </div>
        <div class="portal-card">
            <div class="branding-preview">
                <div class="logo-preview">
                    {% if account.logo_data_url %}
                    <img src="{{ account.logo_data_url }}" alt="{{ account.company_name }} logo" class="current-logo">
                    {% else %}
                    <div class="logo-placeholder">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                        <p class="muted">No logo uploaded</p>
                    </div>
                    {% endif %}
                </div>
                <div class="logo-actions">
                    <form method="post" action="{% url 'clients:dashboard' %}" enctype="multipart/form-data" class="logo-upload-form">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="upload_logo">
                        <div class="form-group">
                            <label for="id_logo" class="btn btn-primary">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                {% if account.logo_data_url %}Update Logo{% else %}Upload Logo{% endif %}
                            </label>
                            <input type="file" id="id_logo" name="logo" accept="image/*" style="display: none;" onchange="this.form.submit()">
                        </div>
                    </form>
                    {% if account.logo_data_url %}
                    <form method="post" action="{% url 'clients:dashboard' %}" style="display: inline;">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="remove_logo">
                        <button type="submit" class="btn btn-ghost" onclick="return confirm('Remove your logo?')">
                            Remove Logo
                        </button>
                    </form>
                    {% endif %}
                </div>
            </div>
            <p class="help-text">
                Recommended: Square logo (PNG or JPG), minimum 200x200px. Maximum file size: 2MB.
            </p>
        </div>
    </section>
    {% endif %}

    {# Onboarding Tour #}
    <section class="settings-section">
        <div class="settings-section-header">
            <h2>Onboarding Tour</h2>
            <p class="muted">Review the guided tour anytime</p>
        </div>
        <div class="portal-card">
            <div class="settings-row">
                <div class="setting-info">
                    <h4>Restart Tour</h4>
                    <p class="muted">Replay the onboarding walkthrough to refresh your knowledge</p>
                </div>
                <form method="post" action="{% url 'clients:onboarding-reset' %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline">Restart Tour</button>
                </form>
            </div>
        </div>
    </section>

    {# Security & Access - Password Change #}
    <section class="settings-section">
        <div class="settings-section-header">
            <h2>Security & Access</h2>
            <p class="muted">Manage password and login preferences</p>
        </div>
        <div class="portal-card">
            <form method="post" class="settings-form" id="password-form">
                {% csrf_token %}
                <input type="hidden" name="action" value="change_password">
                <div class="settings-row">
                    <div class="setting-info">
                        <h4>Change Password</h4>
                        <p class="muted">Update your account password</p>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="id_current_password">Current Password</label>
                        {{ password_form.current_password }}
                        {% if password_form.current_password.errors %}
                        <span class="form-error">{{ password_form.current_password.errors.0 }}</span>
                        {% endif %}
                    </div>
                    <div class="form-group">
                        <label for="id_new_password1">New Password</label>
                        {{ password_form.new_password1 }}
                        {% if password_form.new_password1.errors %}
                        <span class="form-error">{{ password_form.new_password1.errors.0 }}</span>
                        {% endif %}
                        <span class="form-help">At least 8 characters</span>
                    </div>
                    <div class="form-group">
                        <label for="id_new_password2">Confirm New Password</label>
                        {{ password_form.new_password2 }}
                        {% if password_form.new_password2.errors %}
                        <span class="form-error">{{ password_form.new_password2.errors.0 }}</span>
                        {% endif %}
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Update Password</button>
                </div>
            </form>
        </div>
    </section>

    {# Notifications - Email Preferences #}
    <section class="settings-section">
        <div class="settings-section-header">
            <h2>Notifications</h2>
            <p class="muted">Control how and when you receive updates</p>
        </div>
        <div class="portal-card">
            <form method="post" class="settings-form" id="email-preferences-form">
                {% csrf_token %}
                <input type="hidden" name="action" value="update_email_preferences">
                <div class="settings-row toggle-row">
                    <div class="setting-info">
                        <h4>Weekly Summary Email</h4>
                        <p class="muted">Receive a weekly digest of your assessment activity and candidate results</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" name="receive_weekly_summary" {% if account.receive_weekly_summary %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-row toggle-row">
                    <div class="setting-info">
                        <h4>Assessment Completion Alerts</h4>
                        <p class="muted">Get notified when a candidate completes an assessment</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" name="receive_completion_alerts" {% if account.receive_completion_alerts %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-row toggle-row">
                    <div class="setting-info">
                        <h4>New Candidate Alerts</h4>
                        <p class="muted">Get notified when a new candidate starts an assessment</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" name="receive_new_candidate_alerts" {% if account.receive_new_candidate_alerts %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Save Preferences</button>
                </div>
            </form>
        </div>
    </section>

    {# Help & Support #}
    <section class="settings-section">
        <div class="settings-section-header">
            <h2>Help & Support</h2>
            <p class="muted">Get assistance with your account</p>
        </div>
        <div class="portal-card">
            <div class="support-options">
                <div class="support-option">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                        <polyline points="22,6 12,13 2,6"></polyline>
                    </svg>
                    <div>
                        <h4>Email Support</h4>
                        <p class="muted">Get help from our team</p>
                        <a href="mailto:support@evalon.app" class="link-with-arrow" style="margin-top: 0.5rem;">
                            support@evalon.app
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                                <polyline points="12 5 19 12 12 19"></polyline>
                            </svg>
                        </a>
                    </div>
                </div>
                <div class="support-option">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    <div>
                        <h4>Documentation</h4>
                        <p class="muted">Learn how to use Evalon</p>
                        <a href="mailto:support@evalon.app?subject=Documentation%20Request" class="link-with-arrow" style="margin-top: 0.5rem;">
                            Request documentation
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                                <polyline points="12 5 19 12 12 19"></polyline>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

{% endblock %}
