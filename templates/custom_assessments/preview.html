{% extends 'portal_base.html' %}
{% load static %}
{% block title %}Preview - {{ assessment.name }} Â· Evalon{% endblock %}
{% block meta_description %}Preview how your assessment will appear to candidates{% endblock %}
{% block portal_content %}
<div class="preview-shell">
    <!-- Preview Header -->
    <div class="preview-header">
        <div class="preview-banner">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
            </svg>
            <span>Preview Mode - This is how candidates will see the assessment</span>
            <a href="{% url 'custom_assessments:questions' assessment.uuid %}" class="btn btn-small btn-outline">Exit Preview</a>
        </div>
    </div>

    <!-- Simulated Candidate View -->
    <div class="candidate-preview">
        <div class="session-header-preview">
            <div class="session-header-content">
                <div class="header-left">
                    <span class="assessment-badge">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                            <path d="M2 17l10 5 10-5"></path>
                            <path d="M2 12l10 5 10-5"></path>
                        </svg>
                        {{ assessment.name }}
                    </span>
                </div>
                <div class="header-progress">
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" id="preview-progress" style="width: 0%"></div>
                    </div>
                    <div class="progress-stats-compact">
                        <span class="stat-item">
                            <strong id="current-question">1</strong>/{{ total_questions }}
                        </span>
                        <span class="stat-item time-left">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            {{ assessment.time_limit_minutes }} min
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <div class="preview-content">
            {% for question in questions %}
            <div class="question-preview-card" data-index="{{ forloop.counter }}" {% if not forloop.first %}style="display: none;"{% endif %}>
                <div class="question-card-enhanced">
                    <div class="question-header">
                        {% if question.category %}
                        <span class="question-category">{{ question.category }}</span>
                        {% endif %}
                        <span class="question-number">Question {{ forloop.counter }} of {{ total_questions }}</span>
                    </div>

                    <h2 class="question-title">{{ question.question_text }}</h2>

                    <div class="question-options">
                        <p class="input-instruction">Select the best answer:</p>
                        <div class="options-list-preview">
                            {% for letter, text in question.get_options %}
                            <label class="option-preview {% if letter == question.correct_answer %}correct-answer{% endif %}">
                                <input type="radio" name="preview-answer-{{ question.pk }}" value="{{ letter }}">
                                <span class="option-content">{{ text }}</span>
                                {% if letter == question.correct_answer %}
                                <span class="correct-indicator">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="20 6 9 17 4 12"></polyline>
                                    </svg>
                                    Correct Answer
                                </span>
                                {% endif %}
                            </label>
                            {% endfor %}
                        </div>
                    </div>

                    {% if question.explanation %}
                    <div class="explanation-preview">
                        <strong>Explanation (shown after submission):</strong>
                        <p>{{ question.explanation }}</p>
                    </div>
                    {% endif %}
                </div>

                <div class="preview-navigation">
                    {% if not forloop.first %}
                    <button class="btn btn-outline" onclick="showQuestion({{ forloop.counter|add:'-1' }})">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5"></path>
                            <path d="m12 19-7-7 7-7"></path>
                        </svg>
                        Previous
                    </button>
                    {% else %}
                    <div></div>
                    {% endif %}

                    {% if forloop.last %}
                    <button class="btn btn-primary" disabled>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9 11 12 14 22 4"></polyline>
                            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                        </svg>
                        Submit (Preview)
                    </button>
                    {% else %}
                    <button class="btn btn-primary" onclick="showQuestion({{ forloop.counter|add:'1' }})">
                        Next
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14"></path>
                            <path d="m12 5 7 7-7 7"></path>
                        </svg>
                    </button>
                    {% endif %}
                </div>
            </div>
            {% empty %}
            <div class="empty-state">
                <h3>No Questions Yet</h3>
                <p>Add questions to preview the assessment</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<style>
.preview-shell {
    max-width: 900px;
    margin: 0 auto;
}

.preview-header {
    margin-bottom: 24px;
}

.preview-banner {
    display: flex;
    align-items: center;
    gap: 12px;
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    border: 2px solid #f59e0b;
    border-radius: 12px;
    padding: 16px 20px;
    font-weight: 600;
    color: #92400e;
}

.preview-banner svg {
    flex-shrink: 0;
}

.preview-banner span {
    flex: 1;
}

.btn-small {
    padding: 8px 16px;
    font-size: 13px;
}

.candidate-preview {
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: 16px;
    overflow: hidden;
}

.session-header-preview {
    background: white;
    border-bottom: 2px solid #e2e8f0;
}

.session-header-content {
    padding: 16px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 20px;
}

.assessment-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    border: 1px solid #bae6fd;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    color: #0e1428;
}

.assessment-badge svg {
    color: #ff8a00;
}

.header-progress {
    flex: 1;
    min-width: 0;
}

.progress-bar-container {
    width: 100%;
    height: 8px;
    background: #e2e8f0;
    border-radius: 100px;
    overflow: hidden;
    margin-bottom: 8px;
}

.progress-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #ff8a00 0%, #ff6b00 100%);
    border-radius: 100px;
    transition: width 0.3s ease;
}

.progress-stats-compact {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    font-size: 13px;
    color: #718096;
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 4px;
}

.stat-item strong {
    color: #0e1428;
    font-weight: 700;
}

.time-left {
    color: #ff8a00;
    font-weight: 600;
}

.preview-content {
    padding: 32px;
}

.question-card-enhanced {
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 16px;
    padding: 32px;
    margin-bottom: 24px;
}

.question-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
}

.question-category {
    display: inline-flex;
    padding: 6px 12px;
    background: linear-gradient(135deg, #fff3e0 0%, #ffe8cc 100%);
    border: 1px solid #ff8a00;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #ff8a00;
}

.question-number {
    font-size: 13px;
    color: #718096;
    font-weight: 500;
}

.question-title {
    font-size: 22px;
    font-weight: 700;
    color: #0e1428;
    line-height: 1.4;
    margin: 0 0 24px;
}

.input-instruction {
    font-size: 15px;
    font-weight: 600;
    color: #0e1428;
    margin: 0 0 16px;
}

.options-list-preview {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.option-preview {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 16px 20px;
    background: #fff;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 15px;
    color: #0e1428;
    line-height: 1.5;
    position: relative;
}

.option-preview:hover {
    border-color: #ff8a00;
    background: #fff9f5;
}

.option-preview input[type="radio"] {
    width: 20px;
    height: 20px;
    accent-color: #ff8a00;
    flex-shrink: 0;
    margin-top: 2px;
}

.option-preview.correct-answer {
    border-color: #10b981;
    background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
}

.correct-indicator {
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    gap: 6px;
    color: #059669;
    font-size: 12px;
    font-weight: 700;
}

.correct-indicator svg {
    color: #059669;
}

.explanation-preview {
    margin-top: 20px;
    padding: 16px;
    background: #f0f9ff;
    border-left: 4px solid #3b82f6;
    border-radius: 8px;
}

.explanation-preview strong {
    display: block;
    font-size: 13px;
    color: #1e40af;
    margin-bottom: 8px;
}

.explanation-preview p {
    margin: 0;
    font-size: 14px;
    color: #4a5568;
    line-height: 1.6;
}

.preview-navigation {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    border: 2px solid transparent;
}

.btn-primary {
    background: linear-gradient(135deg, #ff8a00 0%, #ff6b00 100%);
    color: white;
}

.btn-primary:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.btn-outline {
    background: white;
    border-color: #e2e8f0;
    color: #0e1428;
}

.btn-outline:hover {
    border-color: #ff8a00;
}

.empty-state {
    text-align: center;
    padding: 48px 20px;
}

.empty-state h3 {
    margin: 0 0 8px;
    color: var(--navy);
}

.empty-state p {
    color: var(--text-muted);
    margin: 0;
}

@media (max-width: 640px) {
    .preview-banner {
        flex-direction: column;
        text-align: center;
    }

    .session-header-content {
        flex-direction: column;
        gap: 12px;
    }

    .question-card-enhanced {
        padding: 20px;
    }

    .question-title {
        font-size: 18px;
    }

    .preview-navigation {
        flex-direction: column;
        gap: 12px;
    }

    .preview-navigation .btn {
        width: 100%;
        justify-content: center;
    }
}
</style>

<script>
const totalQuestions = {{ total_questions }};

function showQuestion(index) {
    // Hide all questions
    document.querySelectorAll('.question-preview-card').forEach(card => {
        card.style.display = 'none';
    });

    // Show target question
    const target = document.querySelector(`.question-preview-card[data-index="${index}"]`);
    if (target) {
        target.style.display = 'block';
    }

    // Update progress
    document.getElementById('current-question').textContent = index;
    const progress = ((index - 1) / totalQuestions) * 100;
    document.getElementById('preview-progress').style.width = `${progress}%`;
}
</script>
{% endblock %}
