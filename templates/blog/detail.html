{% extends 'base.html' %}
{% load humanize static %}
{% block title %}{{ post.meta_title|default:post.title }} · Evalon{% endblock %}
{% block meta_description %}{{ post.meta_description|default:post.excerpt }}{% endblock %}
{% block extra_meta %}
    {% if post.meta_keywords %}<meta name="keywords" content="{{ post.meta_keywords }}">{% endif %}
    {% if post.meta_image %}<meta property="og:image" content="{{ post.meta_image }}">{% endif %}
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="{{ post.published_at|date:'c' }}">
    <meta property="article:modified_time" content="{{ post.updated_at|date:'c' }}">
    <meta property="article:author" content="{{ post.display_author }}">
    {% if post.category %}<meta property="article:section" content="{{ post.category.name }}">{% endif %}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Article",
        "headline": "{{ post.title|escapejs }}",
        "description": "{{ post.meta_description|default:post.excerpt|escapejs }}",
        "author": {
            "@type": "Person",
            "name": "{{ post.display_author|escapejs }}"
        },
        "datePublished": "{{ post.published_at|date:'c' }}",
        "dateModified": "{{ post.updated_at|date:'c' }}",
        {% if post.meta_image or post.hero_image %}"image": "{{ post.meta_image|default:post.hero_image }}",{% endif %}
        "publisher": {
            "@type": "Organization",
            "name": "Evalon",
            "logo": {
                "@type": "ImageObject",
                "url": "{{ request.scheme }}://{{ request.get_host }}{% static 'img/logo-glyph.svg' %}"
            }
        },
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "{{ request.build_absolute_uri }}"
        }
    }
    </script>
{% endblock %}
{% block content %}
<div class="page-shell">
    {% include 'includes/site_header.html' with active='blog' %}
    <main>
        <div class="bd-shell">
            <header class="bd-hero">
                <div class="bd-hero-inner">
                    <div class="bd-breadcrumb">
                        <a href="{% url 'blog:list' %}">Blog</a>
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                        <span>{{ post.pill_label }}</span>
                    </div>
                    {% if preview_mode %}
                    <div class="bd-preview-banner">Preview mode — only visible with a valid preview link.</div>
                    {% endif %}
                    <h1 class="bd-title">{{ post.title }}</h1>
                    <div class="bd-meta">
                        <span>{{ post.display_author }}</span>
                        <span class="bd-meta-dot"></span>
                        <span>{{ post.published_at|date:"F j, Y" }}</span>
                        <span class="bd-meta-dot"></span>
                        <span>{{ post.estimated_read_minutes }} min read</span>
                    </div>
                    <div class="bd-progress" data-reading-progress>
                        <span></span>
                    </div>
                </div>
            </header>

            {% if post.hero_image %}
            <figure class="bd-hero-image">
                <img src="{{ post.hero_image }}" alt="{{ post.title }}">
            </figure>
            {% endif %}

            <div class="bd-layout">
                <aside class="bd-toc" id="articleToc">
                    <p class="bd-toc-heading">On this page</p>
                    <nav>
                        <ul data-article-toc></ul>
                    </nav>
                </aside>
                <article class="bd-body" data-article-body>
                    {{ post.body|linebreaks }}
                </article>
            </div>

            {% include 'blog/includes/share_buttons.html' %}
            {% include 'blog/includes/newsletter_cta.html' %}

            {% if recent_posts %}
            <section class="bd-related">
                <h2 class="bd-related-title">Keep reading</h2>
                <div class="bd-related-grid">
                    {% for related in recent_posts %}
                    <a class="bl-card" href="{{ related.get_absolute_url }}">
                        <div class="bl-card-meta">
                            <span class="bl-card-cat">{{ related.pill_label }}</span>
                            <span class="bl-meta-dot"></span>
                            <span>{{ related.published_at|date:"M j, Y" }}</span>
                        </div>
                        <h3 class="bl-card-title">{{ related.title }}</h3>
                        <p class="bl-card-excerpt">{{ related.excerpt }}</p>
                        <div class="bl-card-footer">
                            <span class="bl-card-author">{{ related.display_author }}</span>
                            <span class="bl-card-arrow">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
                            </span>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </section>
            {% endif %}
        </div>
    </main>
</div>
{% endblock %}
