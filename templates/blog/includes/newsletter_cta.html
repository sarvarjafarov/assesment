{# Newsletter signup CTA for blog posts #}
<aside class="article-newsletter">
    <div class="newsletter-content">
        <h3>Stay ahead of hiring trends</h3>
        <p>Get monthly insights on assessments, interviewing, and building great teams. No spam, unsubscribe anytime.</p>
    </div>
    <form class="newsletter-form" data-newsletter-form>
        <div class="newsletter-input-group">
            <input type="email"
                   name="email"
                   placeholder="you@company.com"
                   required
                   aria-label="Email address">
            <button type="submit" class="btn btn-pill">Subscribe</button>
        </div>
        <p class="newsletter-status" data-newsletter-status></p>
    </form>
</aside>


<script>
document.addEventListener('DOMContentLoaded', function() {
    const forms = document.querySelectorAll('[data-newsletter-form]');
    forms.forEach(form => {
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            const email = this.querySelector('input[name="email"]').value;
            const status = this.querySelector('[data-newsletter-status]');
            const btn = this.querySelector('button[type="submit"]');

            btn.disabled = true;
            btn.textContent = 'Subscribing...';

            try {
                const response = await fetch('{% url "pages:newsletter_subscribe" %}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, source: 'blog_article' })
                });

                const data = await response.json();
                status.textContent = data.message;
                status.className = 'newsletter-status ' + (data.success ? 'success' : 'error');

                if (data.success) {
                    this.querySelector('input[name="email"]').value = '';
                }
            } catch (err) {
                status.textContent = 'Something went wrong. Please try again.';
                status.className = 'newsletter-status error';
            } finally {
                btn.disabled = false;
                btn.textContent = 'Subscribe';
            }
        });
    });
});
</script>
